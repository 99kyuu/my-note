<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<title>上传图片并预览</title>
		<style>
	        *{ padding: 0; margin: 0; }
	        .click{ display: block; width: 200px; height: 200px; background-color: #ccc; color: #fff; margin: auto; font-size: 168px; text-align: center; line-height: 200px; cursor: pointer; }
	        #file{ opacity: 0; }
	        .updataImg{ width: 500px; margin: auto; display: block; }
			.number-input{ height: 30px; margin: 0 auto 20px; display: block; box-sizing: border-box; padding: 0 12px; }
			.progress{ width: 90%; margin: 0 auto; display: block; }
		</style>
	</head>
	<body>
		<div class="img_box">
			<label for="file" class="click">+</label>
			<input type="file" id="file" name="picture" onchange="upLoad(this)" />
			<img src="" class="updataImg">

			<input type="number" class="number-input" oninput="inputText(this)">
			<progress class="progress" value="0" max="100"></progress>
		</div>

		<script type="text/javascript">

			function upLoad(source) {
				let file = source.files[0];
				if (!/image\/\w+/.test(file.type)) return alert('文件格式只支持：jpg 和 png');
				getBase64(file);
				// let url = getObjectURL(file);
				// console.log('二进制路径', url);
			}

			// 获取 base64
			function getBase64(_file) {
				let reader = new FileReader();
				reader.onload = () => {
					// reader.result.replace(/\+/g, "%2B").replace(/\&/g, "%26");
					// reader.result.split('+').join('%2B').split('&').join('%26');
					// console.log(JSON.stringify(reader.result));
					console.log(reader.result);
					document.querySelector('.updataImg').src = reader.result;
				}
				reader.readAsDataURL(_file);
			}

			// 获取二进制路径（需要打开服务器调试）
			function getObjectURL(_file) {
				let url = null;
				if (window.createObjectURL) {
					url = window.createObjectURL(_file);
				} else if (window.URL) {
					url = window.URL.createObjectURL(_file);
				} else if (window.webkitURL) {
					url = window.webkitURL.createObjectURL(_file);
				}
				return url;
			}
			
			function inputText(el) {
				if (Number(el.value) == NaN) return;
 				document.querySelector('.progress').value = el.value
			}
		</script>
	</body>
</html>
