<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<title>请求方法</title>
</head>

<body>

</body>
<!-- <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script> -->
<script type="text/javascript">
	/*
		转义base64
		let _img = this.baseImg
		let _img = this.baseImg
		_img = _img.split('+').join('%2B').split('&').join('%26')
		或者
		_img = _img.replace(/\+/g, "%2B").replace(/\&/g, "%26")
	*/
	const Ajax = {
		website: 'http://longrenhui.ws.6-315.com/index.php/wap',
		post (url, sendData, successHandler, errorHandler) {
			// 解析对象传参
			var _data = '';
			for (var key in sendData) {
				_data += '&' + key + '=' + sendData[key];
			}
			_data = _data.slice(1);
			// 检测请求类型
			if (window.fetch) {
				// , { credentials: 'include' } 这个是打开 cookie
				fetch(this.website + url, {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: _data
				}).then(response => {
					// 请求状态
					// console.log(response);
					// 注意，这里不转换 json 下面会 undefined
					return response.json();
				}).then(indexContentData => {
					if (typeof successHandler === 'function') successHandler(indexContentData);
				}).catch(error => {
					if (typeof errorHandler === 'function') errorHandler(error);
				})
			} else {
				var xhr = new XMLHttpRequest();
				xhr.open('POST', this.website + url);
				// xhr.responseType = 'json';
				xhr.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
				xhr.onreadystatechange = function (event){
					if (event.target.readyState !== 4) return ;
					if (event.target.status === 200 || event.target.status === 304) {
						if (typeof successHandler === 'function') successHandler(JSON.parse(event.target.responseText));
					} else {
						if (typeof errorHandler === 'function') errorHandler(event.target.status);
					}
				}
				// xhr.withCredentials = true;		// 打开cookie
				xhr.send(_data);
			}
		},
		get (url, sendData, successHandler, errorHandler) {
			// 解析对象传参
			var _data = '';
			for (var key in sendData) {
				_data += '&' + key + '=' + sendData[key];
			}
			_data = '?'+_data.slice(1);
			// 检测请求类型
			if (window.fetch) {
				fetch(this.website + url + _data).then(response => {
					return response.json();
				}).then(indexContentData => {
					if (typeof successHandler === 'function') successHandler(indexContentData);
				}).catch(error => {
					if (typeof errorHandler === 'function') errorHandler(error);
				})
			} else {
				var xhr = new XMLHttpRequest();
				xhr.open('GET', this.website + url + _data);
				xhr.onreadystatechange = function (event){
					if (event.target.readyState !== 4) return ;
					if (event.target.status === 200 || event.target.status === 304) {
						if (typeof successHandler === 'function') successHandler(JSON.parse(event.target.responseText));
					} else {
						if (typeof errorHandler === 'function') errorHandler(event.target.status);
					}
				}
				// xhr.withCredentials = true;
				xhr.send();
			}
		}
	}
    // 转大写
	// str.toUpperCase()

    // GET
	Ajax.get('/home/test.html',{ id: 1 }, ret => {
		console.log(ret);
	},err => {
		console.log(err);
	});
    //
    // // POST
	Ajax.post('/Agent/trustee_list.html',{ deviceid: '864147010086266', agent_id: '88' }, ret => {
		console.log(ret);
	},err => {
		console.log(err);
	});

	const Fetch = {
		website: 'https://dev.yunjiaxiang.com/api/',
		post (url, sendData, successHandler, errorHandler) {
			// 解析对象传参
			var _data = '';
			for (var key in sendData) {
				_data += '&' + key + '=' + sendData[key];
			}
			_data = _data.slice(1);
			// console.log(JSON.stringify(sendData),_data);
			fetch(this.website + url, {
				method: 'POST',
				headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
				body: _data
			}).then(response => {
				return response.json();
			}).then(indexContentData => {
				if (typeof successHandler === 'function') successHandler(indexContentData);
			}).catch(error => {
				if (typeof errorHandler === 'function') errorHandler(error);
			})
		},
		get (url, sendData, successHandler, errorHandler) {
			var _data = '';
			for (var key in sendData) {
				_data += '&' + key + '=' + sendData[key];
			}
			_data = '?'+_data.slice(1);
			fetch(this.website + url + _data).then(response => {
				return response.json();
			}).then(indexContentData => {
				if (typeof successHandler === 'function') successHandler(indexContentData);
			}).catch(error => {
				if (typeof errorHandler === 'function') errorHandler(error);
			})
		}
	}
	// GET
	// Fetch.get('/home/test.html',{ id: 1 }, ret => {
	// 	console.log(ret);
	// },err => {
	// 	console.log(err);
	// });
    //
    // // POST
	let _obj = {
		"type": ["10"]
	}
	Fetch.post('v1.0/data/dict/list', _obj, ret => {  // , agent_id: '88'
		console.log(ret);
	},err => {
		console.log(err);
	});
	// $.ajax({
	// 	url:  'http://longrenhui.ws.6-315.com/index.php/wap/agent/mine.html',
	// 	data: {
	// 		deviceid: '864147010086266'
	// 	},
	// 	dataType: 'json',
	// 	type: 'post',
	// 	xhrFields:{ // 跨域cookie打开
	// 		withCredentials: true
	// 	},
	// 	crossDomain: true,
	// 	success:function(data){
	// 	   // console.log(data)
	// 	   if (data.success) {
	// 			console.log(data);
	// 	   }else{
	// 			alert(data.message);
	// 	   }
	//    }
	// })
</script>

</html>
